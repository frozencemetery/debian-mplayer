From: Reinhard Tartler <siretart@tauware.de>
Subject: Revert commits r31322, 31299 and 31187 by cehoyos

--- a/libmpcodecs/vf_geq.c
+++ b/libmpcodecs/vf_geq.c
@@ -34,7 +34,7 @@
 #include "vf.h"
 
 #include "libavcodec/avcodec.h"
-#include "libavutil/eval.h"
+#include "libavcodec/eval.h"
 
 struct vf_priv_s {
     AVExpr * e[3];
@@ -116,7 +116,7 @@ static int put_image(struct vf_instance 
             const_values[3]=y;
             for(x=0; x<w; x++){
                 const_values[2]=x;
-                dst[x + y * dst_stride] = av_eval_expr(vf->priv->e[plane],
+                dst[x + y * dst_stride] = ff_eval_expr(vf->priv->e[plane],
                                                        const_values, vf);
             }
         }
@@ -137,7 +137,7 @@ static void uninit(struct vf_instance *v
 //===========================================================================//
 static int vf_open(vf_instance_t *vf, char *args){
     char eq[3][2000] = { { 0 }, { 0 }, { 0 } };
-    int plane, res;
+    int plane;
 
     vf->config=config;
     vf->put_image=put_image;
@@ -178,11 +178,11 @@ static int vf_open(vf_instance_t *vf, ch
             plane==0 ? lum : (plane==1 ? cb : cr),
             NULL
         };
-        res = av_parse_expr(&vf->priv->e[plane], eq[plane], const_names, NULL, NULL, func2_names, func2, 0, NULL);
+        char * a;
+        vf->priv->e[plane] = ff_parse_expr(eq[plane], const_names, NULL, NULL, func2, func2_names, &a);
 
-        if (res < 0) {
-            mp_msg(MSGT_VFILTER, MSGL_ERR, "geq: error loading equation `%s'\n", eq[plane]);
-            return 0;
+        if (!vf->priv->e[plane]) {
+            mp_msg(MSGT_VFILTER, MSGL_ERR, "geq: error loading equation `%s': %s\n", eq[plane], a);
         }
     }
 
--- a/libmpcodecs/vf_qp.c
+++ b/libmpcodecs/vf_qp.c
@@ -32,7 +32,7 @@
 #include "libvo/fastmemcpy.h"
 
 #include "libavcodec/avcodec.h"
-#include "libavutil/eval.h"
+#include "libavcodec/eval.h"
 
 
 struct vf_priv_s {
@@ -66,16 +66,11 @@ static int config(struct vf_instance *vf
                 "qp",
                 NULL
             };
-            double temp_val;
-	    int res;
 
-            res= av_parse_and_eval_expr(&temp_val, vf->priv->eq, const_names, const_values, NULL, NULL, NULL, NULL, NULL, 0, NULL);
-
-            if (res < 0){
-                mp_msg(MSGT_VFILTER, MSGL_ERR, "qp: Error evaluating \"%s\" \n", vf->priv->eq);
-                return 0;
-            }
-            vf->priv->lut[i+129]= lrintf(temp_val);
+            const char *error = NULL;
+            vf->priv->lut[i+129]= lrintf(ff_parse_and_eval_expr(vf->priv->eq, const_values, const_names, NULL, NULL, NULL, NULL, NULL, &error));
+            if (error)
+                mp_msg(MSGT_VFILTER, MSGL_ERR, "qp: Error evaluating \"%s\": %s\n", vf->priv->eq, error);
         }
 
 	return vf_next_config(vf,width,height,d_width,d_height,flags,outfmt);
