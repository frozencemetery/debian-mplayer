Author: <mennucc1@debian.org>
Description: This patch avoids xscreensaver from blanking onto your favorite movie ; it was made by me, based on code posted in mplayer-dev-eng by Adam  TlaÅ‚ka . It works as follows: when the cursor is inside the MPlayer window, and it is hidden, then the cursor is artificially moved  a bit every 10seconds (+-), so as to disable the screensaver. Of course, it would be a VERY bad idea to move aroundthe cursor when it is in another window (e.g. the user may end up clicking the wrong button)- so it does not work when the cursor is outside the MPlayer window.
--- a/libvo/x11_common.c
+++ b/libvo/x11_common.c
@@ -177,6 +177,9 @@ void vo_x11_ewmh_fullscreen(int action)
     }
 }
 
+static int pointer_is_hidden = 0;
+
+
 void vo_hidecursor(Display * disp, Window win)
 {
     Cursor no_ptr;
@@ -196,6 +199,7 @@ void vo_hidecursor(Display * disp, Windo
     bm_no = XCreateBitmapFromData(disp, win, bm_no_data, 8, 8);
     no_ptr = XCreatePixmapCursor(disp, bm_no, bm_no, &black, &black, 0, 0);
     XDefineCursor(disp, win, no_ptr);
+    pointer_is_hidden = 1;
     XFreeCursor(disp, no_ptr);
     if (bm_no != None)
         XFreePixmap(disp, bm_no);
@@ -207,6 +211,7 @@ void vo_showcursor(Display * disp, Windo
     if (WinID == 0)
         return;
     XDefineCursor(disp, win, 0);
+    pointer_is_hidden = 0;
 }
 
 static int x11_errorhandler(Display * display, XErrorEvent * event)
@@ -805,6 +810,7 @@ void vo_x11_uninit(void)
 
 static unsigned int mouse_timer;
 static int mouse_waiting_hide;
+static int mouse_ignore_motion = 0;
 
 int vo_x11_check_events(Display * mydisplay)
 {
@@ -878,7 +884,9 @@ int vo_x11_check_events(Display * mydisp
                     sprintf(cmd_str,"set_mouse_pos %i %i",Event.xmotion.x, Event.xmotion.y);
                     mp_input_queue_cmd(mp_input_parse_cmd(cmd_str));
                 }
-
+		if (mouse_ignore_motion)
+		  mouse_ignore_motion = 0;
+		else
                 if (vo_mouse_autohide)
                 {
                     vo_showcursor(mydisplay, vo_window);
@@ -1443,6 +1451,16 @@ void xscreensaver_heartbeat(void)
 
         XResetScreenSaver(mDisplay);
     }
+
+    static unsigned int last_warp_time = 0;
+    static int fake_move_distance = 16;
+    if (mDisplay &&  vo_window && pointer_is_hidden && (time - last_warp_time ) > 10000) {
+      last_warp_time = time;
+      mouse_ignore_motion = 1;
+      XWarpPointer(mDisplay,  vo_window, None, 0, 0, 0, 0, fake_move_distance, 0);
+      fake_move_distance = -fake_move_distance;
+      mp_msg(MSGT_VO, MSGL_DBG2, "Warping cursor to disable gnome-screensaver.\n");
+    }
 }
 
 static int xss_suspend(Bool suspend)
--- a/DOCS/man/en/mplayer.1
+++ b/DOCS/man/en/mplayer.1
@@ -3257,8 +3257,10 @@ Specify the screen width for video outpu
 do not know the screen resolution like fbdev, x11 and TV-out.
 .
 .TP
-.B \-stop\-xscreensaver (X11 only)
+.B \-stop\-xscreensaver (X11 , KDE and GNOME only)
 Turns off xscreensaver at startup and turns it on again on exit.
+Note that the GNOME screensaver is disabled only as long
+as the mouse cursor is kept inside the MPlayer window.
 If your screensaver supports neither the XSS nor XResetScreenSaver
 API please use \-heartbeat\-cmd instead.
 .
