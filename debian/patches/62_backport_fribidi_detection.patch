From: Reinhard Tartler <siretart@tauware.de>
Subject: make configure use pkg-config for fribidi checks

taken from upstream trunk

r31209 | siretart | 2010-05-24 21:32:17 +0200 (Mon, 24 May 2010) | 11 lines

make configure use pkg-config for fribidi checks

fribidi upstream has dropped fribidi-config in favor of pkg-config
now: http://lists.freedesktop.org/archives/fribidi/2008-May/000532.html

This commit fixes:

http://bugzilla.mplayerhq.hu/show_bug.cgi?id=1675
https://launchpad.net/bugs/556200
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=582784


--- a/configure
+++ b/configure
@@ -473,7 +473,6 @@ Use these options if autodetection fails
   --with-xvmclib=NAME         adapter-specific library name (e.g. XvMCNVIDIA)
 
   --with-freetype-config=PATH path to freetype-config
-  --with-fribidi-config=PATH  path to fribidi-config
   --with-glib-config=PATH     path to glib*-config
   --with-gtk-config=PATH      path to gtk*-config
   --with-sdl-config=PATH      path to sdl*-config
@@ -710,7 +709,6 @@ _macosx_bundle=auto
 _sortsub=yes
 _freetypeconfig='freetype-config'
 _fribidi=auto
-_fribidiconfig='fribidi-config'
 _enca=auto
 _inet6=auto
 _gethostbyname2=auto
@@ -778,9 +776,6 @@ for ac_option do
   --with-freetype-config=*)
     _freetypeconfig=`echo $ac_option | cut -d '=' -f 2`
     ;;
-  --with-fribidi-config=*)
-    _fribidiconfig=`echo $ac_option | cut -d '=' -f 2`
-    ;;
   --with-gtk-config=*)
     _gtkconfig=`echo $ac_option | cut -d '=' -f 2`
     ;;
@@ -6041,8 +6036,7 @@ echores "$_ass"
 
 echocheck "fribidi with charsets"
 if test "$_fribidi" = auto ; then
-    if ( $_fribidiconfig --version ) >/dev/null 2>&1 ; then
-	cat > $TMPC << EOF
+    cat > $TMPC << EOF
 #include <stdio.h>
 /* workaround for fribidi 0.10.4 and below */
 #define FRIBIDI_CHARSET_UTF8 FRIBIDI_CHAR_SET_UTF8
@@ -6055,16 +6049,15 @@ int main(void) {
     return 0;
 }
 EOF
-	_fribidi=no
-	cc_check `$_fribidiconfig --cflags` `$_fribidiconfig --libs` && tmp_run && _fribidi=yes
-    else
-	_fribidi=no
-    fi
+    _fribidi=no
+    _inc_tmp="$($_pkg_config --cflags fribidi)"
+    _ld_tmp="$($_pkg_config --libs fribidi)"
+    cc_check $_inc_tmp $_ld_tmp && _fribidi=yes
 fi
 if test "$_fribidi" = yes ; then
     def_fribidi='#define CONFIG_FRIBIDI'
-    extra_cflags="$extra_cflags `$_fribidiconfig --cflags`"
-    extra_ldflags="$extra_ldflags `$_fribidiconfig --libs`"
+    extra_cflags="$extra_cflags $_inc_tmp"
+    extra_ldflags="$extra_ldflags $_ld_tmp"
 else
     def_fribidi='#undef CONFIG_FRIBIDI'
 fi
